========
Mediatek
========

Pre-requisites
==============

For products based on Mediatek platforms the following requirements must be
fulfilled:

  * Partition layout must include a partition called *efuse*
  * Fuse functionality has to be enabled in the boot (it is off by default)

Data generation
===============

The efuse security properties image is generated by the FAS team using the
tools provided by Mediatek [#mtk_efuse_tool]_. The SONY specific fuse
configuration is specified in an XML file given as input to the tool. The
resulting efuse image is then stored on the security server from where it
can be retrieved and flashed.

Fusing the device
=================

In Mediatek based platforms the default Mediatek Efuse self-blow feature is
used. This means that when the property data has been downloaded to the device
and the Set-security command is given, the XFL simply writes the efuse image
to the dedicated "efuse" partition. Upon reboot, the preloader in the boot
will detect the new data and execute the fusing. After this is done the
contents of the efuse partition is replaced with a status
(success/reblow/broken) for each affected fuse so the result can be verified.

Testing
=======

It is not possible to reverse writing of OTP but it is possible to verify
the result on a Mediatek based device before doing any actual fusing.
In the preloader there is a flag to disable burning fuses and run in
"dry fusing" mode. This causes the boot to perform all steps in the fuse
flow except the actual fusing. To enable this execution mode
EFUSE_PMIC_CONTROL_ENABLE should be set to 0 in file sec_efuse.c in the
preloader [#mtk_dry_fusing]_.

.. rubric:: Footnotes

.. [#mtk_efuse_tool] Mediatek efuse tools: http://review.sonyericsson.net/plugins/gitiles/flashtools/secs-am/+/refs/heads/master/confrepo/cfg_secprop/mtk_efuse/sm33
.. [#mtk_dry_fusing] Preloader fuse control flag: http://review.sonyericsson.net/plugins/gitiles/alps/vendor/mediatek/proprietary/bootable/bootloader/preloader/+/f56ff891e3dd959ee2bf526d3f0f3b5a6c74b01f/platform/mt6765/src/security/sec_efuse.c#14
