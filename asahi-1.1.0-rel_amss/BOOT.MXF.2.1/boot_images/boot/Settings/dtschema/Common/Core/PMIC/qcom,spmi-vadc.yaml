# SPDX-License-Identifier: (BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/.../qcom,spmi-vadc.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Qualcomm SPMI VADC

maintainers:
  - PoC <PoC@qti.qualcomm.com>

description: |
   Qualcomm SPMI PMIC voltage ADC (VADC) is a 16 
   bit sigma-delta ADC provides interface to read voltage
   and temperature



# A dictionary of DT properties for this binding schema
properties:
  compatible:
    const: qcom,spmi-vadc

  use-interrupt:
    description: VADC EOC Interrupt support
    
    
  fullscale-code:
    description: Raw ADC fullscale-code
    
    
  fullscale-uV:
    description: ADC fullscale-uV
    
    
  fullratiometric-code:
    description: ADC fullratiometric-code
    
    
  read-timeout-uS:
    description: ADC read timeout-uS
    
    
  ldo-settling-uS:
    description: ADC LDO settling-uS
    
    
  slave-id:
    description: Device slave-id
    
    
  peripheral-id:
    description: ADC peripheral-id
    
    
  master-id:
    description: Interrupt master-id
    
    
  pmic-device:
    description: PMIC device
    

  bus-id:
    description: SPMI bus-id
    
  therm-tbl:
    description: Thermistor table

  vadc_ch_cfg:
    type: object

    patternProperties:
      "^.*":
        type: object
        
        properties:
          hw-channel:
            description: ADC hw-channel
            
            
          settling-delay-uS:
            description: ADC conversion settling-delay-uS
            
              
          average-sample:
            description: Channel coversion average-sample
            
            
          decimation-ratio:
            description: ADC HW channel decimation-ratio
            
              
          cal-method:
            description: ADC HW channel cal-method
            $ref: /schemas/types.yaml#/definitions/string
            
          scaling-factor:
            description: ADC HW channel scaling-factor
            $ref: /schemas/types.yaml#/definitions/uint32-array
              
          offset-factor:
            description: Physical value offset-factor
            
            
          scaling-method:
            description: ADC conversion scaling-method
            $ref: /schemas/types.yaml#/definitions/string
            
          adc-sid:
            description: ADC device sid
            
            
          int-table: true
            
        required:
          - hw-channel
          - settling-delay-uS
          - average-sample
          - decimation-ratio
          - cal-method
          - scaling-factor
          - offset-factor
          - scaling-method
          - pull-up-res
          - adc-sid
    

  vadc-avg-ch:
    type: object
    
    properties:
      ch-name:
        description: ADC avg-channel client name
        $ref: /schemas/types.yaml#/definitions/string
        
      low-name:
        description: ADC avg-channel over low pull-up
        $ref: /schemas/types.yaml#/definitions/string
          
      med-name:
        description: ADC avg-channel name med pull-up
        $ref: /schemas/types.yaml#/definitions/string
        
      high-name:
        description: ADC avg-channel name over high pull-up
        $ref: /schemas/types.yaml#/definitions/string
          
      med-to-low:
        description: Blended result range for med-to-low
        
        
      low-to-med:
        description: Blended result range for low-to-med
        
          
      high-to-med:
        description: Blended result range for high-to-med
        
        
      med-to-high:
        description: Blended result range for med-to-high
        
        
    #required:
      #- ch-name
      #- low-name
      #- med-name
      #- high-name
      #- med-to-low
      #- low-to-med
      #- high-to-med
      #- med-to-high
      
  gpio-map:
    type: object
    
    properties:
      aux_pin1:
        type: object
      
        properties:
          pmic-sid:
            description: pmic-sid
            
          
          gpio-num:
            description: gpio-num
            
          
      aux_pin2:
        type: object
      
        properties:
          pmic-sid:
            description: pmic-sid
            
          
          gpio-num:
            description: gpio-num
        
required:
  - compatible
  - use-interrupt
  - fullscale-code            
  - fullscale-uV
  - fullratiometric-code
  - read-timeout-uS
  - ldo-settling-uS
  - slave-id
  - peripheral-id
  - master-id
  - pmic-device
  - therm-tbl
  - vadc_ch_cfg
  - vadc-avg-ch
  - gpio-map
  

additionalProperties: false

examples:
  - |
    vadc {
      spmi-vadc {
        compatible = "qcom,spmi-vadc";
        use-interrupt = <0>;
        fullscale-code = <0x70e4>;             
        fullscale-uV = <1875000>;
        fullratiometric-code = <0x4000>;
        read-timeout-uS = <500000>;
        ldo-settling-uS = <67>;
        slave-id = <0>;            /* SID for Tokei, main ADC interface */
        peripheral-id = <0x31>;    /* PID for ADC instance used */
        master-id = <0>;
        pmic-device = <0>;
        bus-id = <0>;             /* bus id */
        therm-tbl;
     
        vadc_ch_cfg { 
           VPH_PWR {
              hw-channel = <0x8e>;
              settling-delay-uS = <0>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "abs ";
              scaling-factor = <1 3>;    /* Scaling factor N / D */
              offset-factor = <0>;       /* Offset value after scaling */
              scaling-method = "tomV";   /* Value scale to mV */
              pull-up-res = <0>;
              adc-sid = <0x3>;
           };
           
           PMIC_TEMP3 {
              hw-channel = <0x3>;
              settling-delay-uS = <0>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "abs ";
              scaling-factor = <1 1>;
              offset-factor = <(-273000)>;
              scaling-method = "xtuV";
              pull-up-res = <0>;
              adc-sid = <0x3>;
              int-table = <433700 213000>; /* pmic_die_temp_tb address (&pmic_die_temp_tb) */
           };
           
           CHG_TEMP {
              hw-channel = <0x10>;
              settling-delay-uS = <0>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "abs ";
              scaling-factor = <1 1>;
              offset-factor = <0>;
              scaling-method = "tomV";
              pull-up-res = <0>;
              adc-sid = <0x3>;
           };
           
           BATT_THERM {
              hw-channel = <0x44>;
              settling-delay-uS = <100>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "raio";
              scaling-factor = <1 1>;
              offset-factor = <(-273)>;
              scaling-method = "xtr ";
              pull-up-res = <100000>;
              adc-sid = <0x3>;
              int-table = <433700 213000>; /* &sys_therm_tb */
           };
           
           BATT_THERM_PU_30K {
              hw-channel = <0x24>;
              settling-delay-uS = <100>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "raio";
              scaling-factor = <1 1>;
              offset-factor = <(-273)>;
              scaling-method = "xtr ";
              pull-up-res = <30000>;
              adc-sid = <0x3>;
              int-table = <433700 213000>; /* &sys_therm_tb */
           };
           
           BATT_THERM_PU_400K {
              hw-channel = <0x64>;
              settling-delay-uS = <100>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "raio";
              scaling-factor = <1 1>;
              offset-factor = <(-273)>;
              scaling-method = "xtr ";
              pull-up-res = <400000>;
              adc-sid = <0x3>;
              int-table = <433700 213000>; /* &sys_therm_tb */
           };

           BATT_THERM_OHMS {
              hw-channel = <0x44>;
              settling-delay-uS = <100>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "raio";
              scaling-factor = <1 1>;
              offset-factor = <0>;
              scaling-method = "res ";
              pull-up-res = <100000>;
              adc-sid = <0x3>;
              int-table = <433700 213000>; /* &sys_therm_tb */
           };
   
           BATT_ID_OHMS {
              hw-channel = <0x45>;
              settling-delay-uS = <100>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "raio";
              scaling-factor = <1 1>;
              offset-factor = <0>;
              scaling-method = "res ";
              pull-up-res = <100000>;
              adc-sid = <0x3>;
           };

           BATT_ID_OHMS_PU_30K {
              hw-channel = <0x25>;
              settling-delay-uS = <100>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "raio";
              scaling-factor = <1 1>;
              offset-factor = <0>;
              scaling-method = "res ";
              pull-up-res = <30000>;
              adc-sid = <0x3>;
           };
           
           BATT_ID_OHMS_PU_400K {
              hw-channel = <0x65>;
              settling-delay-uS = <100>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "raio";
              scaling-factor = <1 1>;
              offset-factor = <0>;
              scaling-method = "res ";
              pull-up-res = <400000>;
              adc-sid = <0x3>;
           };
           
           VBATT {
              hw-channel = <0x8f>;
              settling-delay-uS = <0>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "abs ";
              scaling-factor = <1 3>;
              offset-factor = <0>;
              scaling-method = "tomV";
              pull-up-res = <0>;
              adc-sid = <0x3>;
           };
           
           VBATT_2S {
              hw-channel = <0x8f>;
              settling-delay-uS = <0>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "abs ";
              scaling-factor = <1 6>;
              offset-factor = <0>;
              scaling-method = "tomV";
              pull-up-res = <0>;
              adc-sid = <0x3>;
           };
           
           VBATT_2S_MID {
              hw-channel = <0x96>;
              settling-delay-uS = <0>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "abs ";
              scaling-factor = <1 3>;
              offset-factor = <0>;
              scaling-method = "tomV";
              pull-up-res = <0>;
              adc-sid = <0x3>;
           };
           
           USB_IN {
              hw-channel = <0x11>;
              settling-delay-uS = <0>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "abs ";
              scaling-factor = <1 16>;
              offset-factor = <0>;
              scaling-method = "tomV";
              pull-up-res = <0>;
              adc-sid = <0x3>;
              int-table = <433700 213000>; /* pmic_die_temp_tb address (&pmic_die_temp_tb) */
           };

           VWLS {
              hw-channel = <0x12>;
              settling-delay-uS = <0>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "abs ";
              scaling-factor = <1 16>;
              offset-factor = <0>;
              scaling-method = "tomV";
              pull-up-res = <0>;
              adc-sid = <0x3>;
              int-table = <433700 213000>; /* pmic_die_temp_tb address (&pmic_die_temp_tb) */
           };
           
           USB_IN_I {
              hw-channel = <0x17>;
              settling-delay-uS = <0>;
              average-sample = <1>;
              decimation-ratio = <1024>;
              cal-method = "abs ";
              scaling-factor = <8 25>;
              offset-factor = <0>;
              scaling-method = "tomV";
              pull-up-res = <0>;
              adc-sid = <0x3>;
              int-table = <433700 213000>; /* pmic_die_temp_tb address (&pmic_die_temp_tb) */
           };
        };
     
        vadc-avg-ch {
           ch-name = "XO_THERM_GPS";
           low-name = "XO_THERM_GPS_LOW";
           med-name = "XO_THERM_GPS_MED";
           high-name = "XO_THERM_GPS_HIGH";
           med-to-low = <5120>;
           low-to-med = <15360>;
           high-to-med = <32768>;
           med-to-high = <43008>;
        };
     
        gpio-map { 
           /* For GPIO that need to be used for ADC input, Set the PMIC SID + GPIO number here */
           aux_pin1 {
              pmic-sid = <0>;
              gpio-num = <1>;
           };
           aux_pin2 {
              pmic-sid = <1>;
              gpio-num = <2>;
           };
        };
      };
    };
